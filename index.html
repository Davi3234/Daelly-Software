painel.php

<?php
session_start();
if (!isset($_SESSION["email"])) {
    header("location: login.php");
}

require_once "../control/ControlMaquinaCosturaMapa.php";
require_once "../model/DaoMaquinaCosturaMapa.php";
require_once "../model/MaquinaCosturaMapa.php";
require_once "../control/ControlMapa.php";
require_once "../model/DaoMapa.php";

$control = new ControlMaquinaCosturaMapa();
$controlMapa = new ControlMapa();

if($_SERVER['REQUEST_METHOD'] == 'POST') {
    $maquinasAlteradas = json_decode($_POST["maquinas"])->maquinas;

    foreach($maquinasAlteradas as $mc) {
        $control->editar($mc->id, $mc->posicionado, $mc->x, $mc->y);
    }
}

$maquinas = $control->listar();
$maquinasMapa = $control->listarMCMapa();
$maquinasInventario = $control->listarMCInventario();
$mapa = $controlMapa->selecionar();

$data = '{"maquinas":[';
$i = 0;
if ($maquinas) foreach ($maquinas as $mc) {
    if ($i > 0) {
        $data .= ',';
    }
    $data .= json_encode($mc);
    $i++;
}
$data .= ']}';
?>
    <html>

    <head>
        <?php include 'header.php' ?>
    </head>

    <body>

        <nav id="header-content" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar-collapse">
                    <span class="sr-only">Menu</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                    <a class="navbar-brand" href="">Daelly Confec��es</a>
                    <ul class="user-menu">
                        <li class="dropdown pull-right">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <svg class="glyph stroked male-user">
                                <use xlink:href="#stroked-male-user"></use>
                            </svg><span class="nome_usuario">Usuário Logado </span><span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="logout.php"><svg class="glyph stroked cancel">
                                        <use xlink:href="#stroked-cancel"></use>
                                    </svg> Logout</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <?php include 'nome.php' ?>
        <div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main">
            <div id="carregando">
                Carregando...
            </div>

            <div id="conteudo">
                <div class="row">
                    <ol class="breadcrumb">
                        <li><a href=""><svg class="glyph stroked home">
                                <use xlink:href="#stroked-home"></use>
                            </svg></a></li>
                        <li class="active">Painel de Gerenciamento</li>
                    </ol>
                </div>

                <form action="" method="post" id="editar-maquinas-mapa">
                    <input id="maquinas-input" name="maquinas" type="text" hidden value='{"maquinas":[]}'>
                    <div class="panel-heading">
                        <button id="bt-salvar-maquinas" type="submit" title="Gravar alterações" class="btn btn-primary" data-toggle="tooltip" data-placement="auto"><svg class="glyph stroked checkmark">
                            <use xlink:href="#stroked-checkmark" />
                        </svg> Gravar</button>
                        <button id="bt-resetar-maquinas" title="Resetar alterações" onclick="resetarMaquinasAlteradas()" type="button" class="btn btn-primary resetar" data-toggle="tooltip" data-placement="auto"><svg class="glyph stroked arrow left">
                                        <use xlink:href="#stroked-arrow-left" />
                                    </svg> Resetar</button>
                    </div>
                    <div id="mapa-content">
                        <div id="mapa-box">
                            <div id="mapa" style="width: <?php echo $mapa->largura_mapa ?>px; height: <?php echo $mapa->altura_mapa ?>px;">
                                <div class="listas-maquinas" id="lista-maquinas-mapa" ondrop="dropMapa(event)" ondragover="allowDrop(event)">
                                    <?php if ($maquinasMapa) foreach ($maquinasMapa as $mc) { ?>
                                    <div draggable="true" ondragstart="drag(event)" class="maquinas" id="maquina-<?php echo $mc->codigo ?>" style="left: <?php echo $mc->x ?>px; top: <?php echo $mc->y ?>px; width: <?php echo $mapa->largura_mc ?>px; height: <?php echo $mapa->altura_mc ?>px;">
                                        <?php echo $mc->codigo ?>
                                    </div>
                                    <?php } ?>
                                </div>
                            </div>
                        </div>

                        <div id="inventario" style="height: <?php echo $mapa->altura_mc + 20 ?>px;">
                            <div class="listas-maquinas" id="lista-maquinas-inventario" ondrop="dropInventario(event)" ondragover="allowDrop(event)">
                                <?php if ($maquinasInventario) foreach ($maquinasInventario as $mc) { ?>
                                <div draggable="true" ondragstart="drag(event)" class="maquinas" id="maquina-<?php echo $mc->codigo ?>" style="width: <?php echo $mapa->largura_mc ?>px; height: <?php echo $mapa->altura_mc ?>px;">
                                    <?php echo $mc->codigo ?>
                                </div>
                                <?php } ?>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div id="maquina-info-content">
            <strong>Máquina <span id="mc-info-codigo"></span></strong>
            <button>Adicionar a máquina ao inventário</button>
        </div>

        <script src="../js/ControlMapa.js"></script>
        <script>
            ! function($) {
                $(document).on("click", "ul.nav li.parent > a > span.icon", function() {
                    $(this).find('em:first').toggleClass("glyphicon-minus")
                })
                $(".sidebar span.icon").find('em:first').addClass("glyphicon-plus")
                $(".parent#menu-item-inicio").addClass("active");
            }(window.jQuery)

            $(window).on('resize', function() {
                if ($(window).width() > 768)
                    $('#sidebar-collapse').collapse('show')
            })
            $(window).on('resize', function() {
                if ($(window).width() <= 767)
                    $('#sidebar-collapse').collapse('hide')
            })

        </script>
        <script>
            const {
                maquinas
            } = JSON.parse(JSON.stringify(<?php echo $data ?>))
            const maquinasAlteradas = []

            $(document).ready(function() {
                $('[data-toggle="tooltip"]').tooltip()
                $('#carregando').fadeOut()
                $('#conteudo').fadeIn()
                $('#editar-maquinas-mapa').submit((ev) => {
                    if (maquinasAlteradas.length <= 0) {
                        ev.preventDefault()
                        return
                    }

                    editarMaquinasAlteradas()
                })
            })

            function editarMaquinasAlteradas() {
                const tag = document.getElementById("maquinas-input")

                let data = `{"maquinas":${JSON.stringify(maquinasAlteradas)}}`

                tag.value = data
            }

        </script>
    </body>

    </html>



    ------------------------------------------------------ funcionarios.php

    <?php include 'header.php' ?>
    </head>

    <body>

        <body>

            <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar-collapse">
                        <span class="sr-only">Menu</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                        <a class="navbar-brand" href="">Daelly Confec��es</a>
                        <ul class="user-menu">
                            <li class="dropdown pull-right">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <svg class="glyph stroked male-user">
                                    <use xlink:href="#stroked-male-user"></use>
                                </svg><span class="nome_usuario">Usuário Logado </span><span class="caret"></span>
                                </a>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="logout.php"><svg class="glyph stroked cancel">
                                            <use xlink:href="#stroked-cancel"></use>
                                        </svg> Logout</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>


            <?php include 'nome.php' ?>

            <div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main">
                <div id="carregando">
                    Carregando...
                </div>
                <div id="conteudo">

                    <div class="row">
                        <ol class="breadcrumb">
                            <li><a href="index.php"><svg class="glyph stroked home">
                                    <use xlink:href="#stroked-home"></use>
                                </svg></a></li>
                            <li class="active">Funcion�rios</li>
                        </ol>
                    </div>

                    <div class="row">
                        <div class="col-lg-12">
                            <h1 class="page-header">Funcion�rios</h1>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-default">

                                <div class="panel-body">
                                    <form action="" method="POST" id="form">
                                        <input type="hidden" value="" name="id" id="id" />
                                        <input type="hidden" value="" name="acao" id="acao" />

                                        <?php if (isset($mensagem)) { ?>
                                        <div class="alert alert-success">
                                            <a href="#" class="close" data-dismiss="alert" aria-label="close">X</a>
                                            <?php echo $mensagem; ?>
                                        </div>
                                        <?php } ?>

                                        <?php if (isset($erros)) { ?>
                                        <div class="alert alert-danger">
                                            <?php echo $erros; ?>
                                        </div>
                                        <?php } ?>

                                        <table data-toggle="table" data-show-refresh="true" data-id-field="1" data-show-toggle="true" data-show-columns="false" data-search="true" data-select-item-name="selecionados[]" data-pagination="true" data-sort-name="name" data-sort-order="desc">
                                            <thead>
                                                <tr>
                                                    <th data-sortable="true">Nome</th>
                                                    <th data-sortable="true">CPF</th>
                                                    <th data-sortable="true">Entrada</th>
                                                    <th data-sortable="true">Sa�da</th>
                                                    <th data-sortable="true">Grupo</th>
                                                    <th data-sortable="true">A��es</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <?php if ($funcionarios) foreach ($funcionarios as $f) { ?>
                                                <tr>
                                                    <td>
                                                        <?php echo $f->nome ?>
                                                    </td>
                                                    <td>
                                                        <?php echo $f->cpf ?>
                                                    </td>
                                                    <td>
                                                        <?php echo $f->entrada ?>
                                                    </td>
                                                    <td>
                                                        <?php echo $f->saida ?>
                                                    </td>
                                                    <td>
                                                        <?php echo $f->grupo ? $f->grupo : "Nenhum" ?>
                                                    </td>
                                                    <td>
                                                        <a href="#" class="editar" rel="<?php echo $f->id ?>">Editar</a>&nbsp;&nbsp;&nbsp;
                                                        <a href="#" class="excluir" rel="<?php echo $f->id ?>">Excluir</a>
                                                    </td>
                                                </tr>
                                                <?php } ?>
                                            </tbody>
                                        </table>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>


            ------------------------------- cadastro-funcionario.php

            <html>

            <head>
                <?php include 'header.php' ?>
            </head>

            <body>

                <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
                    <div class="container-fluid">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar-collapse">
                    <span class="sr-only">Menu</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                            <a class="navbar-brand" href="">Daelly Confec��es</a>
                            <ul class="user-menu">
                                <li class="dropdown pull-right">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                        <svg class="glyph stroked male-user">
                                <use xlink:href="#stroked-male-user"></use>
                            </svg><span class="nome_usuario">Usu�rio Logado </span><span class="caret"></span>
                                    </a>
                                    <ul class="dropdown-menu" role="menu">
                                        <li><a href="logout.php"><svg class="glyph stroked cancel">
                                        <use xlink:href="#stroked-cancel"></use>
                                    </svg> Logout</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>


                <?php include 'nome.php' ?>

                <div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main">
                    <div id="carregando">
                        Carregando...
                    </div>
                    <div id="conteudo">

                        <div class="row">
                            <ol class="breadcrumb">
                                <li><a href="index.php"><svg class="glyph stroked home">
                                <use xlink:href="#stroked-home"></use>
                            </svg></a></li>
                                <li class="active">Funcion�rios</li>
                            </ol>
                        </div>

                        <div class="row">
                            <div class="col-lg-12">
                                <h1 class="page-header">Funcion�rios</h1>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="panel panel-default">
                                    <form action="" method="POST" id="form" name="form">
                                        <input hidden type="text" name="funcoes-selecionadas" id="funcoes-input" value='{"funcoes":[]}'>
                                        <div class="panel-heading">
                                            <button type="submit" id="gravar" class="btn btn-primary" data-toggle="tooltip" title="Gravar o registro" data-placement="auto"><svg class="glyph stroked checkmark">
                                        <use xlink:href="#stroked-checkmark" />
                                    </svg> Gravar</button>
                                            <button type="button" class="btn btn-primary voltar" data-toggle="tooltip" title="Voltar para a listagem" data-placement="auto"><svg class="glyph stroked arrow left">
                                        <use xlink:href="#stroked-arrow-left" />
                                    </svg> Voltar</button>
                                        </div>
                                        <div class="panel-body">

                                            <?php if (isset($mensagem)) { ?>
                                            <div class="alert alert-success">
                                                <a href="#" class="close" data-dismiss="alert" aria-label="close">X</a>
                                                <?php echo $mensagem; ?>
                                            </div>
                                            <?php } ?>

                                            <?php if (isset($erros)) { ?>
                                            <div class="alert alert-danger">
                                                <?php echo $erros; ?>
                                            </div>
                                            <?php } ?>

                                            <div class="campo_esquerda">
                                                <input type="text" class="form-control" value="<?php echo (isset($_POST['nome'])) ? $_POST['nome'] : " " ?>" name="nome" id="nome" placeholder="Informe o nome" required="required" data-toggle="tooltip" title="Informe o nome" data-placement="auto" />
                                            </div>
                                            <div class="campo_direita">
                                                <input type="text" class="form-control" value="<?php echo (isset($_POST['cpf'])) ? $_POST['cpf'] : " " ?>" name="cpf" id="cpf" placeholder="Informe o CPF" required="required" data-toggle="tooltip" title="Informe o CPF" data-placement="auto" />
                                            </div>
                                            <div class="campo_esquerda">
                                                <input type="date" class="form-control" value="<?php echo (isset($_POST['entrada'])) ? $_POST['entrada'] : " " ?>" name="entrada" id="entrada" placeholder="Informe a data de entrada" required="required" data-toggle="tooltip" title="Informe a data de entrada"
                                                    data-placement="auto" />
                                            </div>
                                            <div class="campo_direita">
                                                <input type="date" class="form-control" value="<?php echo (isset($_POST['saida'])) ? $_POST['saida'] : " " ?>" name="saida" id="saida" placeholder="Informe a data de sa�da" data-toggle="tooltip" title="Informe a data de sa�da" data-placement="auto" />
                                            </div>
                                            <div class="form-check campo_esquerda">
                                                <?php
                                    foreach ($listaFun as $f) {
                                    ?>
                                                    <input name="funcoes[]" class="form-check-input" type="checkbox" value="<?php echo $f->id ?>" id="flexCheckDefault">
                                                    <label class="form-check-label" for="flexCheckDefault"><?php echo $f->nome ?></label>
                                                    <br>
                                                    <?php
                                    }
                                    ?>
                                            </div>
                                            <div class="campo_direita">
                                                <select class="form-control" id="id_grupo" name="id_grupo">
                                        <option value="0">Selecione</option>
                                        <?php
                                        foreach ($listaGru as $g) {
                                        ?>
                                            <option value="<?php echo $g->id ?>"><?php echo $g->numero ?></option>
                                        <?php
                                        }
                                        ?>
                                    </select>
                                            </div>
                                        </div>
                                </div>
                            </div>
                            </form>
                        </div>
                    </div>
                </div>
                </div>
                </div>

                <script>
                    ! function($) {
                        $(document).on("click", "ul.nav li.parent > a > span.icon", function() {
                            $(this).find('em:first').toggleClass("glyphicon-minus");
                        });
                        $(".sidebar span.icon").find('em:first').addClass("glyphicon-plus");
                        $(".parent#menu-item-funcionario").addClass("active");
                    }(window.jQuery);

                    $(window).on('resize', function() {
                        if ($(window).width() > 768)
                            $('#sidebar-collapse').collapse('show')
                    })
                    $(window).on('resize', function() {
                        if ($(window).width() <= 767)
                            $('#sidebar-collapse').collapse('hide')
                    })

                </script>
                <script>
                    $(document).ready(function() {
                        $('[data-toggle="tooltip"]').tooltip();
                        $('#carregando').fadeOut();
                        $('#conteudo').fadeIn();

                        $(".voltar").click(function() {
                            $(location).attr("href", "funcionarios.php");
                        });

                        $('#form').submit((ev) => {
                            const funcoesSelecionadas = []
                            document.getElementsByName("funcoes[]").forEach(tag => {
                                if (!tag.checked) {
                                    return
                                }
                                funcoesSelecionadas.push(Number(tag.value))
                            })

                            const data = `{"funcoes":${JSON.stringify(funcoesSelecionadas)}}`

                            document.getElementById("funcoes-input").value = data
                        })
                    });
                    $(document).ready(function() {
                        $("#cpf").mask("999.999.999-99");
                    });

                </script>

            </body>

            </html>
